# This is a basic workflow for pull and build CTM using GitHub Actions
name: Pull & Build CTM using GitHub Actions

# Controls when the action will run. Triggers the workflow on push request
# events but only for the main branch
on:
  push:
    branches:
      - main
      
# A workflow run is made up of one or more jobs that can run sequentially or in parallel    
jobs:
  # The first job in this workflow is named build-on-ubuntu
  build-on-ubuntu:
    runs-on: ubuntu-latest
  
    # Steps represent a sequence of tasks that will be executed as part of the job
    steps: 
      - uses: actions/checkout@v2      
      
      - name: Step 1 - Log the pre-build disc space
        run: ls
      
      - name: Step 2 - Deploy source-code to the host
        uses: appleboy/scp-action@master
        env:
          HOST: ${{ secrets.SSH_HOST }}
          USERNAME: ${{ secrets.SSH_USERNAME }}
          PORT: 22
          KEY: ${{ secrets.SSH_KEY }}
        with:
          source: "*"
          target: "/home/gitactionuser/test"
          
      - name: Step x - Log the pre-build disc space
        run: pwd                 
        shell: sh
          
      - name: Step 3 - the current working  dir      
        run: mvn -f ~/home/gitactionuser/test/pom.xml clean install     
        shell: sh
    
      - name: Step 1 - Log the pre-build disc space
        run: ls
        
      - name: Experiment
        run: |
          cd home/gitactionuser/test/
          pwd             
          mkdir hello
          cd hello
          pwd             
